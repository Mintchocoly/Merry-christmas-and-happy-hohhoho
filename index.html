<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Special Christmas Gift</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Great+Vibes&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #ui { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; pointer-events: none; }
        /* D√≤ng ch·ªØ nh·ªè, th∆° m·ªông ·ªü g√≥c m√†n h√¨nh sau khi b·∫Øt ƒë·∫ßu */
        .name-tag { font-family: 'Great Vibes', cursive; font-size: 1.5rem; color: #FFD700; text-shadow: 0 0 10px #ff0000; position: fixed; top: 20px; right: 20px; opacity: 0; transition: 3s; }
        .active { opacity: 1; }
        /* N√∫t b·∫•m lung linh */
        button { pointer-events: auto; padding: 15px 40px; border-radius: 50px; background: linear-gradient(45deg, #d4af37, #f9f295); border: none; font-family: 'Dancing Script', cursive; font-size: 1.5rem; cursor: pointer; box-shadow: 0 0 30px #ffd700; transition: 0.5s; }
        button:hover { transform: scale(1.1); box-shadow: 0 0 50px gold; }
    </style>
</head>
<body>
    <div id="ui">
        <button id="btn" onclick="startMagic()">‚ú® M·ªû QU√Ä PH√ÅO HOA ‚ú®</button>
        <h1 id="name" class="name-tag">G·ª≠i t·∫∑ng [T√™n Ng∆∞·ªùi Nh·∫≠n] üéÑ</h1>
    </div>

    <audio id="bgm" loop><source src="https://www.chosic.com/wp-content/uploads/2021/11/Let-it-snow-Let-it-snow-Let-it-snow.mp3" type="audio/mpeg"></audio>

    <script>
        let scene, camera, renderer, particles, snow, state = 0;
        const count = 25000; // S·ªë l∆∞·ª£ng h·∫°t s√°ng c·ª±c l·ªõn ƒë·ªÉ t·∫°o h√¨nh full l·ªông l·∫´y
        let targetPos = new Float32Array(count * 3);
        
        function startMagic() {
            document.getElementById('btn').style.display = 'none';
            document.getElementById('name').classList.add('active');
            document.getElementById('bgm').play();
            init();
        }

        function createShape(type) {
            let pts = new Float32Array(count * 3);
            for (let i = 0; i < count; i++) {
                let x, y, z;
                if (type === 0) { // C√ÇY TH√îNG KH·ªîNG L·ªí 3D
                    y = (Math.random() * 45) - 20;
                    let r = (25 - y) * 0.55;
                    let theta = Math.random() * Math.PI * 2;
                    x = r * Math.cos(theta); z = r * Math.sin(theta);
                    if (i > count * 0.95) { x *= 0.2; y = 26; z *= 0.2; } // Ng√¥i sao tr√™n ƒë·ªânh
                } else if (type === 1) { // GINGERBREAD MAN & CANDY CANE
                    let t = Math.random() * Math.PI * 2;
                    x = 20 * Math.sin(t) * Math.pow(Math.sin(t/2), 2);
                    y = 22 * Math.cos(t); z = (Math.random()-0.5)*8;
                } else if (type === 2) { // H·ªòP QU√Ä CH·ªÆ TH·∫¨P RUY BƒÇNG (TRUY·ªÄN TH·ªêNG)
                    x = (Math.random()-0.5)*30; y = (Math.random()-0.5)*30; z = (Math.random()-0.5)*30;
                    if (i % 15 < 5) { // T·∫°o d·∫£i ruy bƒÉng xanh ƒë·ªè
                        if (Math.random() > 0.5) { x *= 0.12; } else { y *= 0.12; }
                    }
                } else { // PH√ÅO HOA TUA RUA R·ª¶ XU·ªêNG C·ªî T√çCH
                    let r = 40 * Math.sqrt(Math.random());
                    let theta = Math.random() * Math.PI * 2;
                    x = r * Math.cos(theta);
                    y = 35 - (r * r / 12) - (Math.random() * 25);
                    z = r * Math.sin(theta);
                }
                pts[i*3] = x; pts[i*3+1] = y; pts[i*3+2] = z;
            }
            return pts;
        }

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.z = 80;
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            const geo = new THREE.BufferGeometry();
            const pos = new Float32Array(count * 3);
            const colors = new Float32Array(count * 3);
            targetPos = createShape(0);

            for (let i = 0; i < count; i++) {
                pos[i*3] = (Math.random()-0.5)*400;
                pos[i*3+1] = (Math.random()-0.5)*400;
                pos[i*3+2] = (Math.random()-0.5)*400;
                let c = new THREE.Color();
                c.setHSL(Math.random(), 0.9, 0.7);
                colors[i*3] = c.r; colors[i*3+1] = c.g; colors[i*3+2] = c.b;
            }

            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            particles = new THREE.Points(geo, new THREE.PointsMaterial({size: 0.28, vertexColors: true, blending: THREE.AdditiveBlending}));
            scene.add(particles);

            const sGeo = new THREE.BufferGeometry();
            const sPos = new Float32Array(4000 * 3);
            for(let i=0; i<12000; i++) sPos[i] = (Math.random()-0.5)*250;
            sGeo.setAttribute('position', new THREE.BufferAttribute(sPos, 3));
            snow = new THREE.Points(sGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.18, transparent: true, opacity: 0.8}));
            scene.add(snow);

            window.addEventListener('mousedown', () => { state = (state + 1) % 4; targetPos = createShape(state); });
            window.addEventListener('touchstart', () => { state = (state + 1) % 4; targetPos = createShape(state); });
            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            const positions = particles.geometry.attributes.position.array;
            for (let i = 0; i < count * 3; i++) {
                positions[i] += (targetPos[i] - positions[i]) * 0.035; // T·ªëc ƒë·ªô bi·∫øn h√¨nh m∆∞·ª£t m√†
            }
            particles.geometry.attributes.position.needsUpdate = true;
            particles.rotation.y += 0.004;
            snow.position.y -= 0.1; if(snow.position.y < -120) snow.position.y = 120;
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
