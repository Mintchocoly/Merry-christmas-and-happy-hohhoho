<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Merry Christmas - The Masterpiece</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Great+Vibes&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #ui-layer { position: fixed; width: 100%; height: 100%; background: radial-gradient(circle, #1a1a1a, #000); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 2000; transition: 1.5s; }
        .title { font-family: 'Great Vibes', cursive; font-size: 5rem; color: #fff; text-shadow: 0 0 20px gold; margin-bottom: 30px; }
        #start-btn { padding: 15px 60px; border-radius: 50px; background: gold; border: none; font-family: 'Dancing Script', cursive; font-size: 2.2rem; cursor: pointer; box-shadow: 0 0 30px gold; }
        #name-tag { position: fixed; bottom: 30px; right: 30px; font-family: 'Dancing Script', cursive; font-size: 2rem; color: gold; opacity: 0; transition: 3s; z-index: 500; text-shadow: 2px 2px 10px #000; }
        .hidden { opacity: 0; pointer-events: none; }
    </style>
</head>
<body>
    <div id="ui-layer">
        <div class="title">Merry Christmas</div>
        <button id="start-btn" onclick="startMagic()">B·∫•m ƒë·ªÉ m·ªü qu√†</button>
    </div>
    <div id="name-tag">G·ª≠i t·∫∑ng [T√™n Ng∆∞·ªùi Nh·∫≠n] üéÑ</div>
    <audio id="bgm" loop><source src="https://www.chosic.com/wp-content/uploads/2021/11/Let-it-snow-Let-it-snow-Let-it-snow.mp3" type="audio/mpeg"></audio>

    <script>
        /** * T√ÅI HI·ªÜN C√ÇY TH√îNG 50.000 H·∫†T S√ÅNG
         */
        let scene, camera, renderer, particles, snow, targetPositions;
        const P_COUNT = 50000; // S·ªë l∆∞·ª£ng h·∫°t c·ª±c l·ªõn ƒë·ªÉ ƒë·∫°t ƒë·ªô n√©t nh∆∞ ·∫£nh
        let mouseX = 0, mouseY = 0;

        function startMagic() {
            document.getElementById('ui-layer').classList.add('hidden');
            document.getElementById('name-tag').style.opacity = '1';
            document.getElementById('bgm').play();
            init();
        }

        function createTreeShape() {
            const data = new Float32Array(P_COUNT * 3);
            for (let i = 0; i < P_COUNT; i++) {
                let x, y, z;
                if (i < P_COUNT * 0.75) { // D·ª±ng th√¢n c√¢y h√¨nh n√≥n d√†y
                    let h = Math.random() * 60;
                    let r = (60 - h) * 0.38 * (Math.pow(Math.random(), 0.5) + 0.5);
                    let t = Math.random() * Math.PI * 2;
                    x = r * Math.cos(t); y = h - 30; z = r * Math.sin(t);
                } else if (i < P_COUNT * 0.82) { // Ng√¥i sao r·ª±c r·ª° tr√™n ƒë·ªânh
                    let t = Math.random() * Math.PI * 2;
                    let r = 5 * Math.random();
                    x = Math.cos(t) * r; y = 32 + (Math.random()*5); z = Math.sin(t) * r;
                } else { // C√°c h·ªôp qu√† m√†u s·∫Øc d∆∞·ªõi g·ªëc
                    x = (Math.random()-0.5)*55; y = -30 + Math.random()*10; z = (Math.random()-0.5)*55;
                }
                data[i*3] = x; data[i*3+1] = y; data[i*3+2] = z;
            }
            return data;
        }

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.z = 100;

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            const geo = new THREE.BufferGeometry();
            const positions = new Float32Array(P_COUNT * 3);
            const colors = new Float32Array(P_COUNT * 3);
            targetPositions = createTreeShape();

            for (let i = 0; i < P_COUNT; i++) {
                // T·ªça ƒë·ªô kh·ªüi t·∫°o (bay t·ª´ ngo√†i v√†o)
                positions[i*3] = (Math.random()-0.5)*800;
                positions[i*3+1] = (Math.random()-0.5)*800;
                positions[i*3+2] = (Math.random()-0.5)*800;

                let col = new THREE.Color();
                let r = Math.random();
                if (r > 0.8) col.setHex(0xffd700); // V√†ng Gold
                else if (r > 0.5) col.setHex(0xff0000); // ƒê·ªè Noel
                else col.setHex(0xffffff); // Tr·∫Øng
                colors[i*3] = col.r; colors[i*3+1] = col.g; colors[i*3+2] = col.b;
            }

            geo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            particles = new THREE.Points(geo, new THREE.PointsMaterial({
                size: 0.35, vertexColors: true, blending: THREE.AdditiveBlending, transparent: true
            }));
            scene.add(particles);

            // Th√™m hi·ªáu ·ª©ng tuy·∫øt r∆°i n·ªÅn
            const snowGeo = new THREE.BufferGeometry();
            const snowPos = new Float32Array(15000 * 3);
            for(let i=0; i<45000; i++) snowPos[i] = (Math.random()-0.5)*500;
            snowGeo.setAttribute('position', new THREE.BufferAttribute(snowPos, 3));
            snow = new THREE.Points(snowGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.15}));
            scene.add(snow);

            document.addEventListener('mousemove', (e) => {
                mouseX = (e.clientX - window.innerWidth/2) / 10;
                mouseY = (e.clientY - window.innerHeight/2) / 10;
            });

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            const p = particles.geometry.attributes.position.array;
            for (let i = 0; i < P_COUNT * 3; i++) {
                p[i] += (targetPositions[i] - p[i]) * 0.05;
            }
            particles.geometry.attributes.position.needsUpdate = true;
