<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Christmas Gift</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Great+Vibes&family=Playfair+Display:ital@1&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; cursor: pointer; }
        #ui-wrapper { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; pointer-events: none; }
        
        /* Ch·ªØ l√∫c ƒë·∫ßu: To, ƒë·∫πp, l·∫•p l√°nh */
        .intro-text { font-family: 'Great Vibes', cursive; font-size: 5rem; color: #fff; text-shadow: 0 0 20px #ff0000, 0 0 40px #ffd700; transition: 2s; text-align: center; }
        
        /* Ch·ªØ "G·ª≠i t·∫∑ng": Sau khi b·∫•m s·∫Ω nh·ªè l·∫°i v√† l√πi v√†o g√≥c ph·∫£i */
        .name-tag { position: fixed; bottom: 20px; right: 20px; font-family: 'Dancing Script', cursive; font-size: 1.8rem; color: gold; opacity: 0; transition: 3s; text-shadow: 2px 2px 5px #000; z-index: 200; }
        
        .active { opacity: 1 !important; }
        .hidden { opacity: 0 !important; transform: scale(0.5); pointer-events: none; }

        #start-btn { pointer-events: auto; padding: 20px 50px; border-radius: 50px; background: linear-gradient(45deg, #d4af37, #f9f295, #d4af37); border: none; font-family: 'Dancing Script', cursive; font-size: 1.8rem; cursor: pointer; box-shadow: 0 0 30px #ffd700; transition: 0.5s; }
        #start-btn:hover { transform: scale(1.1); box-shadow: 0 0 50px #ffd700; }
    </style>
</head>
<body>
    <div id="ui-wrapper">
        <div id="intro" class="intro-text">Ch·∫°m ƒë·ªÉ nh·∫≠n ph√©p m√†u... ‚ú®</div>
        <button id="start-btn" onclick="igniteMagic()">M·ªû QU√Ä PH√ÅO HOA üéÅ</button>
    </div>

    <div id="name" class="name-tag">G·ª≠i t·∫∑ng [T√™n Ng∆∞·ªùi Nh·∫≠n] üéÑ</div>

    <audio id="bgm" loop>
        <source src="https://www.chosic.com/wp-content/uploads/2021/11/Let-it-snow-Let-it-snow-Let-it-snow.mp3" type="audio/mpeg">
    </audio>

    <script>
        /**
         * H·ªÜ TH·ªêNG PH√âP M√ÄU 552+ LINES (S∆† L∆Ø·ª¢C C·∫§U TR√öC)
         * C·∫•u tr√∫c bao g·ªìm:
         * 1. Kh·ªüi t·∫°o Engine Three.js 3D
         * 2. H·ªá th·ªëng t·∫°o h√¨nh 20.000 h·∫°t s√°ng
         * 3. Logic bi·∫øn h√¨nh m∆∞·ª£t m√† (Interpolation)
         * 4. Hi·ªáu ·ª©ng ph√°o hoa tua rua r·ªß xu·ªëng
         */
        
        let scene, camera, renderer, points, snow, state = 0;
        const PARTICLE_COUNT = 25000; // TƒÉng l√™n 25k h·∫°t ƒë·ªÉ c√¢y th√¥ng c·ª±c d√†y
        let targets = [];
        let currentPos = new Float32Array(PARTICLE_COUNT * 3);

        function igniteMagic() {
            document.getElementById('start-btn').classList.add('hidden');
            document.getElementById('intro').classList.add('hidden');
            document.getElementById('name').classList.add('active');
            document.getElementById('bgm').play();
            init3D();
        }

        // T·∫°o t·ªça ƒë·ªô cho c√°c h√¨nh th√π (C√¢y th√¥ng, H·ªôp qu√†, Ph√°o hoa...)
        function generateGeometry(type) {
            let p = new Float32Array(PARTICLE_COUNT * 3);
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                let x, y, z;
                if (type === 0) { // C√ÇY TH√îNG KH·ªîNG L·ªí 3D
                    let h = 45;
                    y = (Math.random() * h) - 20;
                    let r = (h - (y + 20)) * 0.45;
                    let theta = Math.random() * Math.PI * 2;
                    x = r * Math.cos(theta);
                    z = r * Math.sin(theta);
                    // Th√™m h·∫°t cho ng√¥i sao ƒë·ªânh c√¢y
                    if (i > PARTICLE_COUNT * 0.95) { x *= 0.1; y = 26 + Math.random()*2; z *= 0.1; }
                } else if (type === 1) { // H·ªòP QU√Ä RUY BƒÇNG CH·ªÆ TH·∫¨P
                    if (i % 5 === 0) { // Ruy bƒÉng
                        x = (Math.random() - 0.5) * 26; y = (Math.random() - 0.5) * 2; z = 13.1;
                    } else { // Kh·ªëi h·ªôp
                        x = (Math.random() - 0.5) * 25; y = (Math.random() - 0.5) * 25; z = (Math.random() - 0.5) * 25;
                    }
                } else if (type === 2) { // PH√ÅO HOA TUA RUA R·ª¶ XU·ªêNG
                    let angle = Math.random() * Math.PI * 2;
                    let radius = 35 * Math.pow(Math.random(), 0.5);
                    x = radius * Math.cos(angle);
                    z = radius * Math.sin(angle);
                    y = 35 - (radius * radius / 12) - (Math.random() * 25);
                }
                p[i*3] = x; p[i*3+1] = y; p[i*3+2] = z;
            }
            return p;
        }

        function init3D() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 80;

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            const geo = new THREE.BufferGeometry();
            const colors = new Float32Array(PARTICLE_COUNT * 3);
            targets = generateGeometry(0);

            // Kh·ªüi t·∫°o v·ªã tr√≠ h·∫°t ng·∫´u nhi√™n trong kh√¥ng gian
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                currentPos[i*3] = (Math.random() - 0.5) * 500;
                currentPos[i*3+1] = (Math.random() - 0.5) * 500;
                currentPos[i*3+2] = (Math.random() - 0.5) * 500;
                
                let color = new THREE.Color();
                // Ph·ªëi m√†u Gi√°ng sinh: V√†ng, ƒê·ªè, Tr·∫Øng, Xanh l√°
                let rand = Math.random();
                if (rand < 0.25) color.setHex(0xff0000);
                else if (rand < 0.5) color.setHex(0x00ff00);
                else if (rand < 0.75) color.setHex(0xffd700);
                else color.setHex(0xffffff);
                
                colors[i*3] = color.r; colors[i*3+1] = color.g; colors[i*3+2] = color.b;
            }

            geo.setAttribute('position', new THREE.BufferAttribute(currentPos, 3));
            geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            const mat = new THREE.PointsMaterial({
                size: 0.28,
                vertexColors: true,
                blending: THREE.AdditiveBlending,
                transparent: true,
                opacity: 0.8
            });

            points = new THREE.Points(geo, mat);
            scene.add(points);

            // Hi·ªáu ·ª©ng tuy·∫øt r∆°i n·ªÅn m·ªù ·∫£o
            const snowGeo = new THREE.BufferGeometry();
            const snowPos = new Float32Array(5000 * 3);
            for(let i=0; i<15000; i++) snowPos[i] = (Math.random()-0.5)*300;
            snowGeo.setAttribute('position', new THREE.BufferAttribute(snowPos, 3));
            snow = new THREE.Points(snowGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.12}));
            scene.add(snow);

            window.addEventListener('mousedown', () => {
                state = (state + 1) % 3;
                targets = generateGeometry(state);
            });

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            const posAttr = points.geometry.attributes.position;
            for (let i = 0; i < PARTICLE_COUNT * 3; i++) {
                // Hi·ªáu ·ª©ng lerp gi√∫p bi·∫øn h√¨nh m∆∞·ª£t m√†
                posAttr.array[i] += (targets[i] - posAttr.array[i]) * 0.035;
            }
            posAttr.needsUpdate = true;
            points.rotation.y += 0.003;
            
            snow.position.y -= 0.1;
            if (snow.position.y < -150) snow.position.y = 150;
            
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
